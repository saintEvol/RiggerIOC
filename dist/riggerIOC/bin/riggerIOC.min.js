var riggerIOC,__extends=this&&this.__extends||function(){var i=function(t,n){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),__decorate=this&&this.__decorate||function(t,n,e,i){var r,o=arguments.length,s=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,e):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,i);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(o<3?r(s):3<o?r(n,e,s):r(n,e))||s);return 3<o&&s&&Object.defineProperty(n,e,s),s},__awaiter=this&&this.__awaiter||function(o,s,a,l){return new(a=a||Promise)(function(t,n){function e(t){try{r(l.next(t))}catch(t){n(t)}}function i(t){try{r(l.throw(t))}catch(t){n(t)}}function r(n){n.done?t(n.value):new a(function(t){t(n.value)}).then(e,i)}r((l=l.apply(o,s||[])).next())})},__generator=this&&this.__generator||function(e,i){var r,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function n(n){return function(t){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,o=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){a.label=n[1];break}if(6===n[0]&&a.label<s[1]){a.label=s[1],s=n;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(n);break}s[2]&&a.ops.pop(),a.trys.pop();continue}n=i.call(e,a)}catch(t){n=[6,t],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,t])}}};!function(i){var t=(Object.defineProperty(n,"instance",{get:function(){return n.mInstance||(n.mInstance=new n),n.mInstance},enumerable:!0,configurable:!0}),n.prototype.bind=function(t){return i.Utils.isString(t)?this.bindString(t):this.bindClass(t)},n.prototype.bindClass=function(t){if(!t)return null;var n=this.findClassBindInfo(t);if(!n){var e=i.InjectionWrapper.wrap(t);n=new i.InjectionBindInfo(t),this.bindedMap[e]=n}return n},n.prototype.bindString=function(t){if(!t)return null;var n=this.findStringBindInfo(t);return n||(this.stringBindedMap[t]=n=new i.InjectionBindInfo(t,i.BindInfoKeyType.STRING)),n},n.prototype.registerInjection=function(t,n){var e=t[this.registerKey];(e=e||(t[this.registerKey]=[])).push(n)},n.prototype.getRegisteredInjection=function(t){return t&&t[this.registerKey]||[]},n.prototype.inject=function(t){var n=t.__proto__[this.registerKey];if(n&&!(n.length<=0))for(var e=n.length,i=0;i<e;++i)t[n[i]]},n.prototype.unbind=function(t){i.Utils.isString(t)?this.unbindString(t):this.unbindClass(t)},n.prototype.unbindString=function(t){this.disposeStringBindInfo(t)},n.prototype.unbindClass=function(t){this.disposeClassBindInfo(t)},n.prototype.findBindInfo=function(t){return i.Utils.isString(t)?this.findStringBindInfo(t):this.findClassBindInfo(t)},n.prototype.findClassBindInfo=function(t){if(!t)return null;if(!this.bindedMap)return null;var n=i.InjectionWrapper.getId(t);return n?this.bindedMap[n]:null},n.prototype.findStringBindInfo=function(t){return t&&this.stringBindedMap?this.stringBindedMap[t]:null},n.prototype.disposeBindInfo=function(t){i.Utils.isString(t)?this.disposeStringBindInfo(t):this.disposeClassBindInfo(t)},n.prototype.disposeClassBindInfo=function(t){if(t){var n=i.InjectionWrapper.getId(t);if(n){var e=this.bindedMap[n];e&&(e.dispose(),delete this.bindedMap[n]),e=null}}},n.prototype.disposeStringBindInfo=function(t){if(t){var n=this.stringBindedMap[t];n&&(n.dispose(),delete this.stringBindedMap[t]),n=null}},n);function n(){this.bindedMap={},this.stringBindedMap={},this.registerKey="_register_key"}i.InjectionBinder=t}(riggerIOC=riggerIOC||{}),function(i){var r,t=(r=i.InjectionBinder,__extends(o,r),o.prototype.bind=function(t){var n;return i.Utils.isString(t)?(n=this.injectionBinder.bindString(t),this.addStringBindInfo(t,n)):(n=this.injectionBinder.bindClass(t),this.addClassBindInfo(t,n)),n},o.prototype.bindDebug=function(t){var n;return i.Utils.isString(t)?(n=this.injectionBinder.bindString(t),this.addStringBindInfo(t,n)):(n=this.injectionBinder.bindClass(t),this.addClassBindInfo(t,n)),n.appId=this.appId,n},o.prototype.registerInjection=function(t,n){this.injectionBinder.registerInjection(t,n)},o.prototype.inject=function(t){this.injectionBinder.inject(t)},o.prototype.unbind=function(t){i.Utils.isString(t)?this.unbindString(t):this.unbindClass(t)},o.prototype.unbindClass=function(t){this.removeClassBindInfo(t),this.injectionBinder.unbindClass(t)},o.prototype.unbindString=function(t){this.removeStringBindInfo(t),this.injectionBinder.unbindString(t)},o.prototype.findBindInfo=function(t){return this.injectionBinder.findBindInfo(t)},o.prototype.dispose=function(){for(var t in this.infos)this.unbindClass(this.infos[t].cls);for(var t in this.stringBindInfos)this.unbindString(this.stringBindInfos[t].cls);this.infos={},this.stringBindInfos={},this.injectionBinder=null,this.owner=null},o.prototype.addStringBindInfo=function(t,n){this.stringBindInfos||(this.stringBindInfos={}),this.stringBindInfos[t]=n},o.prototype.addClassBindInfo=function(t,n){this.infos||(this.infos={});var e=i.InjectionWrapper.getId(t);this.infos[e]=n},o.prototype.removeStringBindInfo=function(t){delete this.stringBindInfos[t]},o.prototype.removeClassBindInfo=function(t){delete this.infos[i.InjectionWrapper.getId(t)]},o);function o(t,n,e){var i=r.call(this)||this;return i.infos={},i.stringBindInfos={},i.appId=t,i.owner=e,i.injectionBinder=n instanceof o?n.injectionBinder:n,i}i.ApplicationInjectionBinder=t,i.setApplicationInjectionBinderDebug=function(){t.prototype.bind=t.prototype.bindDebug}}(riggerIOC=riggerIOC||{}),function(r){var e,t;(t=e=r.BindInfoKeyType||(r.BindInfoKeyType={}))[t.CONSTRUCTOR=1]="CONSTRUCTOR",t[t.STRING=2]="STRING";var n=(Object.defineProperty(i.prototype,"realClass",{get:function(){return this.mBindCls?this.mBindCls:this.keyType==e.STRING?null:this.cls},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"instance",{get:function(){return this.mInstance},set:function(t){t&&r.addRefCount(t);var n=this.mInstance;n&&r.addRefCount(n,-1),this.mInstance=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasInstance",{get:function(){return!!this.instance},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.cls=null,this.mBindCls=null,this.instance=null},i.prototype.to=function(t){if(t===this.cls)throw new Error("can not bind to self.");return this.mBindCls=t,this},i.prototype.toValue=function(t){return this.isToValue=!0,this.toSingleton(),this.instance=t,this},i.prototype.toSingleton=function(){return this.isSingleton=!0,this},i.prototype.getInstance=function(){if(this.isToValue)return this.instance;if(this.instance)return this.instance;if(this.realClass){var t=new this.realClass;return this.isSingleton&&(this.instance=t),t}return null},i.prototype.getInstanceDebug=function(){if(this.isToValue)return this.instance;if(this.instance)return this.instance;var t=this.realClass;if(t){var n=t.prototype,e=void 0;n&&(e=r.getAppId(n),r.setAppId(n,this.appId));var i=new this.realClass;return n&&r.setAppId(n,e),r.setAppId(i,this.appId),r.insertInjectionTrack(i),this.isSingleton&&(this.instance=i),i}return null},i.prototype.toValueDebug=function(t){return this.isToValue=!0,this.toSingleton(),(this.instance=t)&&(r.setAppId(t,this.appId),r.insertInjectionTrack(t,!1)),this},i);function i(t,n){void 0===n&&(n=e.CONSTRUCTOR),this.appId=null,this.cls=null,this.mBindCls=null,this.isSingleton=!1,this.mInstance=null,this.isToValue=!1,this.cls=t,this.keyType=n}r.InjectionBindInfo=n,r.setInjectinBindInfoDebug=function(){n.prototype.toValue=n.prototype.toValueDebug,n.prototype.getInstance=n.prototype.getInstanceDebug}}(riggerIOC=riggerIOC||{}),function(d){d.debug=!1;var p=(t.prototype.add=function(t){++this.refNum,this.totalInjectionNames.push(t),this.injectionName.push(t)},t.prototype.remove=function(n){--this.refNum,this.injectionName=this.injectionName.filter(function(t){return t!==n})},t);function t(){this.refNum=0,this.totalInjectionNames=[],this.injectionName=[]}d.InjectionTrackOwnerShip=p;var i=(Object.defineProperty(n.prototype,"stickyOwners",{get:function(){for(var t=[],n=0;n<this.ownershipStates.length;++n)0<this.ownershipStates[n].refNum&&t.push([this.owners[n],this.ownershipStates[n]]);return t},enumerable:!0,configurable:!0}),n.prototype.toString=function(){var t="";t+="========= "+this.typeName+" =========\r\n",t+="是否由注入产生:\t\t"+(this.isInjected?"是":"否")+"\r\n",t+="App Id: \t\t"+d.getAppId(this.inst)+"\r\n",t+="引用计数:\t\t"+d.getRefCount(this.inst)+"\r\n";for(var n="",e=this.stickyOwners,i=0;i<e.length;++i){for(var r="",o=0;o<e[i][1].injectionName.length;++o)r+=e[i][1].injectionName[o]+", ";0<r.length&&(r=r.substring(0,r.length-1)),n+=e[i][0].typeName+" : "+e[i][1].refNum+" => ["+r+"] ,"}n.length<=0&&(n="无"),t+="现在被谁引用(sticky):\t"+n+"\r\n";var s=this.injectError;return t+="注入错误: \t\t"+(s?s.stack:"无")+"\r\n",t+="析构错误: \t\t"+((s=this.disposeError)?s.stack:"无")},n);function n(t,n){void 0===n&&(n=!0),this.isInjected=!0,this.typeName=null,this.inst=null,this.owners=[],this.ownershipStates=[],this.injectError=null,this.disposeError=null,this.disposeFlag=!1,this.inst=t,this.isInjected=n,this.typeName=t.constructor.name}function e(t){return!!t&&((!t[s]||t[s]<=0)&&t.$autoDis)}function r(t){t.dispose()}function o(t,n){if(t){var e=d.getInjectionTrack(t);(e=e||d.insertInjectionTrack(t,!1)).disposeError=n}}d.InjectionTrack=i,d.insertInjectionTrack=function(t,n){void 0===n&&(n=!0);var e=d.getInjectionTrack(t);return e||(e=new i(t,n),d.getInjectionTrackPool(t).push(e),e)},d.getInjectionTrack=function(i,t){var n;void 0===t&&(t=null);var e=(n=t||d.getInjectionTrackPool(i)).findIndex(function(t,n,e){return t.inst==i});return 0<=e?n[e]:null},d.getInjectionTrackPool=function(t){var n=d.getAppId(t);return n?d.ApplicationContext.getApplication(n).injectionTracks:d.ApplicationContext.globalInjectionTracks},d.setAppId=function(t,n){t&&(t.debug_app_id=n)},d.getAppId=function(t){return t?t.debug_app_id:null},d.addOwnerShip=function(t,n,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!1);var o=d.insertInjectionTrack(t,r),s=o.owners,a=o.ownershipStates,l=s.findIndex(function(t){return t.inst==e});if(l<0&&i<0)throw new Error("try to minus owner ship num , while could not find, obj:"+t.constructor.name+", owner:"+e.constructor.name);if(l<0){var c=d.insertInjectionTrack(e,r);s.push(c);var u=new p;a.push(u),l=s.length-1}var h=s[l];if(h.disposeFlag&&0<i)throw new Error("owner has been disposed, owner:"+h.typeName+", field:"+n+", obj:"+o.typeName);if(0<i?a[l].add(n):a[l].remove(n),a[l].refNum<0)throw new Error("owner ship state less than 0, obj:"+t.constructor.name+", attrName:"+n+", owner:"+e.constructor.name)},d.autoDispose=function(t){var n=t.prototype;if(!n)throw new Error("has no prototype");if(!n.$autoDis){var e=n.dispose;n.dispose=d.hackDispose(e),n.$autoDis=!0}},d.needAutoDispose=e,d.doAutoDispose=r,d.hackDispose=function(e){return function(){e&&e.apply(this);var t=d.InjectionBinder.instance.getRegisteredInjection(this);if(t&&0<t.length)for(var n=0;n<t.length;++n)this[t[n]]=null}},d.hackDisposeDebug=function(i){return function(){o(this,null);try{if(d.getDisposeFlag(this)){var t=d.getInjectionTrack(this);throw new Error("has been disposed:"+t.typeName)}i&&i.apply(this);var n=d.InjectionBinder.instance.getRegisteredInjection(this);if(n&&0<n.length)for(var e=0;e<n.length;++e)this[n[e]]=null;d.setDisposeFlag(this)}catch(t){o(this,t)}}},d.getDisposeError=function(t){if(!t)return null;var n=d.getInjectionTrack(t);return n?n.disposeError:null},d.setDisposeError=o,d.getDisposeFlag=function(t){if(!t)return!0;var n=d.getInjectionTrack(t);return!!n&&n.disposeFlag},d.setDisposeFlag=function(t,n){void 0===n&&(n=!0),t&&(d.insertInjectionTrack(t,!1).disposeFlag=n)},d.inject=function(i){return function(t,n,e){e?d.doInjectGetterSetter(i,t,n,e):d.doInjectAttr(i,t,n)}},d.retrievAble=function(e){return function(t,n){t[e=e||t[n]]=n}};var s="$ref_num";function a(t,n){void 0===n&&(n=1),t[s]||(t[s]=0),t[s]+=n,t[s]<=0&&(delete t[s],e(t)&&r(t))}d.addRefCount=a,d.getRefCount=function(t){return t[s]||0},d.clearRefCount=function(t){delete t[s],e(t)&&r(t)};var l="$$";function c(e,t,i,n){var r=l+i;d.InjectionBinder.instance.registerInjection(t,i),n.get=function(){var t=this[r];if(null==t){var n=d.InjectionBinder.instance.bind(e);t=this[i]=n.getInstance(),n=null}return t},n.set=function(t){if(t){try{d.addOwnerShip(t,i,this)}catch(t){d.insertInjectionTrack(this,!1).injectError=t}a(t)}var n=this[r];n&&(a(n,-1),d.addOwnerShip(n,i,this,-1)),this[r]=t}}function u(e,t,i){var r=l+i;d.InjectionBinder.instance.registerInjection(t,i),Object.defineProperty(t,i,{get:function(){var t=this[r];if(null==t){var n=d.InjectionBinder.instance.bind(e);t=this[i]=n.getInstance(),n=null}return t},set:function(t){if(t){try{d.addOwnerShip(t,i,this)}catch(t){d.insertInjectionTrack(this,!1).injectError=t}a(t)}var n=this[r];n&&(a(n,-1),d.addOwnerShip(n,i,this,-1)),this[r]=t},enumerable:!0,configurable:!0})}d.doInjectGetterSetter=function(e,t,i,n){var r=l+i;d.InjectionBinder.instance.registerInjection(t,i),n.get=function(){var t=this[r];if(null==t){var n=d.InjectionBinder.instance.bind(e);t=this[i]=n.getInstance(),n=null}return t},n.set=function(t){t&&a(t);var n=this[r];n&&a(n,-1),this[r]=t}},d.doInjectAttr=function(e,t,i){var r=l+i;d.InjectionBinder.instance.registerInjection(t,i),Object.defineProperty(t,i,{get:function(){var t=this[r];if(null==t){var n=d.InjectionBinder.instance.bind(e);t=this[i]=n.getInstance(),n=null}return t},set:function(t){t&&a(t);var n=this[r];n&&a(n,-1),this[r]=t},enumerable:!0,configurable:!0})},d.setDebug=function(){d.debug=!0,d.hackDispose=d.hackDisposeDebug,d.doInjectAttr=u,d.doInjectGetterSetter=c,d.setApplicationInjectionBinderDebug(),d.setInjectinBindInfoDebug()},(d.debug||window&&(window["riggerIOC-debug"]||window.CC_DEBUG))&&d.setDebug()}(riggerIOC=riggerIOC||{}),function(e){var t=(n.prototype.dispose=function(){this.cancel(),this.mReason=null,this.mResult=null,this.mDoneCallback=null,this.mCanceledCallback=null,this.waitingTask=null},n.prototype.isDone=function(){return this.mIsDone},n.prototype.isCanceled=function(){return this.mIsCanceled},n.prototype.isWaitting=function(){return null!=this.waitingTask},n.prototype.startTask=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.mIsDone=!1,this.mIsCanceled=!1,this.mResult=null,this.mReason=null,this},n.prototype.getResult=function(){return this.mResult},n.prototype.getReason=function(){return this.mReason},n.prototype.wait=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this.isWaitting())return this.waitingTask;if(this.mIsDone)return this.mResult;if(this.mIsCanceled)return this.mReason;if(this.waitingTask=e.waitFor(this),this.startTask.apply(this,t),!this.waitingTask){if(this.mIsDone)return this.mResult;if(this.mIsCanceled)return this.mReason}return this.waitingTask},n.prototype.done=function(t){void 0===t&&(t=null),this.mIsDone||this.mIsCanceled||(this.mIsDone=!0,this.mResult=t,this.mDoneCallback&&this.mDoneCallback(t),this.mDoneCallback=null,this.mCanceledCallback=null,this.mIsCanceled=!1,this.waitingTask=null)},n.prototype.cancel=function(t){void 0===t&&(t=null),this.mIsCanceled||this.mIsDone||(this.mIsCanceled=!0,this.mReason=t,this.mCanceledCallback&&this.mCanceledCallback(t),this.mCanceledCallback=null,this.mDoneCallback=null,this.mIsDone=!1,this.waitingTask=null)},n.prototype.reset=function(){return this.isWaitting()||(this.mIsCanceled=!1,this.mIsDone=!1,this.mResult=null,this.mReason=null,this.mCanceledCallback=null,this.mDoneCallback=null,this.waitingTask=null),this},n.prototype.setDoneCallback=function(t){this.mDoneCallback=t},n.prototype.setCancelCallback=function(t){this.mCanceledCallback=t},n=__decorate([e.autoDispose],n));function n(){this.mIsDone=!1,this.mResult=null,this.mIsCanceled=!1,this.mReason=null,this.waitingTask=null}e.BaseWaitable=t}(riggerIOC=riggerIOC||{}),function(o){var t=(n.prototype.bind=function(t){this.mInfos||(this.mInfos={});var n=this.findBindInfo(t);if(!n){n=new o.MediationBindInfo(t);var e=o.InjectionWrapper.getId(t);this.mInfos[e]=n}return n},n.prototype.createAndAttach=function(t,n){var e=this.findBindInfo(t);if(!e)return null;if(!e.bindMediatorConstructor)return null;var i=this.injectionBinder.bind(t);i.hasInstance||i.toValue(n);var r=this.injectionBinder.bind(e.bindMediatorConstructor).getInstance();return o.InjectionBinder.instance.inject(r),i.toValue(null),r},n.prototype.detach=function(t,n){t&&o.clearRefCount(t),n&&o.clearRefCount(n)},n.prototype.getAttachedMediatorInstance=function(t){var n=this.bindTuples;if(!n)return null;var e=n.length;if(e<=0)return null;for(var i=0;i<e;++i)if(n[i].view===t)return n[i].mediator;return null},n.prototype.dispose=function(){for(var t in this.mInfos)this.mInfos[t].dispose();if(this.bindTuples&&0<this.bindTuples.length)for(var n=this.bindTuples.length-1;0<=n;--n)this.bindTuples[n].dispose();this.injectionBinder=null,this.bindTuples=[]},n.prototype.findBindInfo=function(t){if(!t)return null;var n=o.InjectionWrapper.getId(t);return n?this.mInfos[n]:null},n.prototype.addBindTuple=function(t,n){this.bindTuples||(this.bindTuples=[]),this.bindTuples.push(new o.ViewMediatorTuple(t,n))},n);function n(t){this.mInfos={},this.injectionBinder=t}o.MediationBinder=t}(riggerIOC=riggerIOC||{}),function(e){var i,t=(i=e.BaseWaitable,__extends(n,i),n.prototype.done=function(t){if(void 0===t&&(t=null),!this.mIsCanceled&&!this.mIsDone){this.mIsDone=!0;var n=new e.Result;n.result=t,this.mResult=n,this.mDoneCallback&&this.mDoneCallback(this.mResult),this.mCanceledCallback=null,this.mDoneCallback=null,this.mIsCanceled=!1,this.waitingTask=null}},n.prototype.cancel=function(t){if(void 0===t&&(t=null),!this.mIsCanceled&&!this.mIsDone){this.mIsCanceled=!0;var n=new e.Result;n.error=null==t||null==t?new Error:t,this.mReason=n,this.mDoneCallback&&this.mDoneCallback(this.mReason),this.mCanceledCallback=null,this.mDoneCallback=null,this.mIsDone=!1,this.waitingTask=null}},n.prototype.wait=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i.prototype.wait.apply(this,t)},n.prototype.getReason=function(){var t=i.prototype.getReason.call(this);return t?t.reason:null},n.prototype.getResult=function(){var t=i.prototype.getResult.call(this);return t?t.result:null},n);function n(){return null!==i&&i.apply(this,arguments)||this}e.SafeWaitable=t}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.dispose=function(){for(var t=this.bindInfos.length-1;0<=t;--t)this.bindInfos[t].dispose();this.bindInfos=[],this.injectionBinder=null},e);function e(t){this.injectionBinder=t,this.bindInfos=[]}t.CommandBinder=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.dispose=function(){},e=__decorate([t.autoDispose],e));function e(){}t.Command=n}(riggerIOC=riggerIOC||{}),function(t){var n,e=(n=t.SafeWaitable,__extends(i,n),i.prototype.forSeconds=function(t,n){return void 0===n&&(n=!0),this.forMSeconds(1e3*t,n)},i.prototype.forMSeconds=function(t,n){if(void 0===n&&(n=!0),null!==this.timerId)return this;if(n){this.waitingMSeconds=null;var e=this;this.timerId=setTimeout(function(){e.timerId=null,e.done(),e=null},t)}else this.waitingMSeconds=t;return this},i.prototype.forFrame=function(){return this.forMSeconds(0)},i.prototype.forever=function(){return this.timerId&&clearTimeout(this.timerId),this.timerId=null,this.waitingMSeconds=null,this},i.prototype.wait=function(){return null!=this.timerId||null==this.waitingMSeconds||this.isWaitting()||this.forMSeconds(this.waitingMSeconds),n.prototype.wait.call(this)},i.prototype.cancel=function(t){(this.waitingMSeconds=null)!==this.timerId&&clearTimeout(this.timerId),this.timerId=null,n.prototype.cancel.call(this,t)},i);function i(){var t=n.call(this)||this;return t.waitingMSeconds=null,t.timerId=null,t}t.WaitForTime=e}(riggerIOC=riggerIOC||{}),function(e){var n,t=(n=e.CommandBinder,__extends(i,n),i.prototype.dispose=function(){throw new Error("NOT IMPLEMENTED")},i.prototype.bind=function(t){this.commandsMap||(this.commandsMap={});var n=this.findBindInfo(t);return n||(this.commandsMap[t]=new e.EventCommandBindInfo(t))},i.prototype.unbind=function(t){throw new Error("NOT IMPLEMENTED")},i.prototype.findBindInfo=function(t){var n=this.commandsMap[t];return n||null},i);function i(t){return n.call(this,t)||this}e.EventCommandBinder=t}(riggerIOC=riggerIOC||{}),function(n){var t=(Object.defineProperty(e.prototype,"viewConstructor",{get:function(){return this.mViewConstructor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bindMediatorConstructor",{get:function(){return this.mBindMediatorConstructor},enumerable:!0,configurable:!0}),e.prototype.to=function(t){return this.mBindMediatorConstructor=t,this},e.prototype.dispose=function(){this.mViewConstructor=null,this.mBindMediatorConstructor=null},e);function e(t){n.InjectionWrapper.wrap(t),this.mViewConstructor=t}n.MediationBindInfo=t}(riggerIOC=riggerIOC||{}),function(a){var t=(n.prototype.dispose=function(){this.appInjectionBinder=null,this.bindSignal&&this.bindSignal.off(this,this.onSignal),this.bindSignal=null,this.commandsCls=[],this.executingCommand&&this.executingCommand.cancel("canceled by riggIOC")},Object.defineProperty(n.prototype,"injectionBinder",{get:function(){return this.appInjectionBinder||a.InjectionBinder.instance},enumerable:!0,configurable:!0}),n.prototype.to=function(t){return this.injectionBinder.bind(t),this.commandsCls.push({cls:t,inst:null}),this},n.prototype.toValue=function(t){return this.commandsCls.push({cls:null,inst:t}),this},n.prototype.once=function(){return this.isOnce=!0,this},n.prototype.inSequence=function(){return this.isInSequence=!0,this},n.prototype.onSignal=function(t){this.isInSequence?this.executeWaitableCommands(t):this.executeCommands(t)},n.prototype.executeCommands=function(t){for(var n,e,i=null,r=0;r<this.commandsCls.length;++r)i=(n=(e=this.commandsCls[r]).inst?e.inst:this.injectionBinder.bind(e.cls).getInstance()).execute(t,i),a.needAutoDispose(n)&&a.doAutoDispose(n);this.isOnce&&this.dispose()},n.prototype.executeWaitableCommands=function(s){return __awaiter(this,void 0,void 0,function(){var n,e,i,r,o;return __generator(this,function(t){switch(t.label){case 0:n=null,r=0,t.label=1;case 1:return r<this.commandsCls.length?(i=this.commandsCls[r],(e=i.inst?i.inst:this.injectionBinder.bind(i.cls).getInstance())instanceof a.WaitableCommand?((this.executingCommand=e).execute(s,n),[4,e.wait()]):[3,3]):[3,5];case 2:return o=t.sent(),a.needAutoDispose(e)&&a.doAutoDispose(e),o.isOk?(n=o.result,this.executingCommand=null,[3,4]):(this.executingCommand=null,[3,5]);case 3:n=e.execute(s,n),a.needAutoDispose(e)&&a.doAutoDispose(e),t.label=4;case 4:return++r,[3,1];case 5:return e=i=null,this.executingCommand=null,this.isOnce&&this.dispose(),[2]}})})},n);function n(t,n){void 0===n&&(n=null),this.appInjectionBinder=null,this.executingCommand=null,this.appInjectionBinder=n,this.commandsCls=[],this.bindSignal=t,this.isOnce=!1,this.isInSequence=!1,t.on(this,this.onSignal)}a.SignalCommandBindInfo=t}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.dispose=function(){this.view=null,this.mediator=null},e);function e(t,n){this.view=t,this.mediator=n}t.ViewMediatorTuple=n}(riggerIOC=riggerIOC||{}),function(e){var t,n=(t=e.CommandBinder,__extends(i,t),i.prototype.bind=function(t){var n=new e.SignalCommandBindInfo(this.injectionBinder.bind(t).toSingleton().getInstance(),this.injectionBinder);return this.bindInfos.push(n),n},i.prototype.unbind=function(t,n){throw void 0===n&&(n=!1),new Error("not implemented")},i);function i(){return null!==t&&t.apply(this,arguments)||this}e.SignalCommandBinder=n}(riggerIOC=riggerIOC||{}),function(r){r.waitForNextFrame=function(){return new Promise(function(t){setTimeout(t,0)})},r.waitForSeconds=function(n,t,e){var i;if(void 0===e&&(e=[]),t){i=(t instanceof r.Handler?t.runWith(e):t())?new Promise(function(t){setTimeout(t,n)}):i=new Promise(function(t){t()})}else i=new Promise(function(t){setTimeout(t,n)});return i},r.waitFor=function(e){return new Promise(function(t,n){e.isDone()?t(e.getResult()):e.isCanceled()?n(e.getReason()):(e.setDoneCallback(t),e.setCancelCallback(n))})}}(riggerIOC=riggerIOC||{}),function(){function t(){}(riggerIOC||(riggerIOC={})).CommandBindInfo=t}(),function(i){var t=(Object.defineProperty(n,"pool",{get:function(){return this.mPool||(this.mPool=new i.Pool),this.mPool},enumerable:!0,configurable:!0}),n.create=function(){return n.pool.getItemByClass(n._sign,n)},Object.defineProperty(n.prototype,"isRunning",{get:function(){return 0<=this.mCursor||null!=this.syncLock},enumerable:!0,configurable:!0}),n.prototype.reset=function(){return this.dispose(),this},n.prototype.recover=function(){this.reset(),n.pool.recover(n._sign,this)},n.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var n,e,i,r,o,s,a,l,c,u;return __generator(this,function(t){switch(t.label){case 0:if(this.isRunning)return[3,7];n=this.mTasks,e=this.mSingleHandlerArgs,i=this.mSingleHandlers,r=this.mSingleCancelHandlers,o=this.mSingleCancelHandlerArgs,this.mCursor=0,s=!1,a=null,t.label=1;case 1:if(!(this.mCursor<n.length))return[3,6];t.label=2;case 2:return t.trys.push([2,4,,5]),[4,n[this.mCursor].wait()];case 3:return l=t.sent(),i[this.mCursor]&&i[this.mCursor].runWith([].concat(e[this.mCursor],l)),[3,5];case 4:return c=t.sent(),s=!0,a=c,r[this.mCursor]&&r[this.mCursor].runWith([].concat(o[this.mCursor],c)),[3,6];case 5:return++this.mCursor,[3,1];case 6:if(s){for(u=this.mCursor+1;u<this.mSingleCancelHandlers.length;++u)this.mSingleCancelHandlers[u]&&this.mSingleCancelHandlers[u].runWith([].concat(this.mSingleCancelHandlerArgs[u],a));this.mCancelHandler&&this.mCancelHandler.runWith([].concat(this.mCancelHandlerArgs,a))}else this.mCompleteHandler&&this.mCompleteHandler.runWith(this.mCompleteHandlerArgs);return this.mCursor=-1,[3,9];case 7:return this.cancel(),[4,this.execute()];case 8:t.sent(),t.label=9;case 9:return[2]}})})},n.prototype.executeAsync=function(e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:if(this.isRunning)return[3,5];for((null==e||null==e||e<0)&&(e=0),this.syncLock=new i.TaskExecutorLock(this.mTasks.length),n=this.syncLock.wait(),this.mCursor=0;this.mCursor<this.mTasks.length;++this.mCursor)this.executeSingle(this.mCursor,this.mCursor*e);t.label=1;case 1:return t.trys.push([1,3,,4]),[4,n];case 2:return t.sent(),this.mCompleteHandler&&this.mCompleteHandler.runWith(this.mCompleteHandlerArgs),[3,4];case 3:return t.sent(),this.mCancelHandler&&this.mCancelHandler.runWith(this.mCancelHandlerArgs),[3,4];case 4:return this.clearTimer(),this.syncLock.dispose(),this.syncLock=null,this.mCursor=-1,[3,7];case 5:return this.cancel(),[4,this.executeAsync(e)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},n.prototype.cancel=function(t){if(void 0===t&&(t=null),this.isRunning){if(this.syncLock){for(var n=0;n<this.mTasks.length;++n)this.mTasks[n].cancel(t);if(this.timers){for(var e in this.timers)this.timers[e].cancel(t);this.timers=null}}else this.mTasks[this.mCursor].cancel(t);return this}},n.prototype.dispose=function(){this.cancel(),this.mCompleteHandler=null,this.mCompleteHandlerArgs=[],this.mCancelHandler=null,this.mCancelHandlerArgs=[],this.mTasks=[],this.mSingleHandlers=[],this.mSingleHandlerArgs=[],this.mSingleCancelHandlers=[],this.mSingleCancelHandlerArgs=[],this.clearTimer()},n.prototype.add=function(t,n,e,i,r){return void 0===n&&(n=null),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===r&&(r=[]),this.mTasks.push(t),this.mSingleHandlers.push(n),this.mSingleHandlerArgs.push(e),this.mSingleCancelHandlers.push(i),this.mSingleCancelHandlerArgs.push(r),this},n.prototype.setCompleteHandler=function(t,n){return void 0===n&&(n=[]),this.mCompleteHandler=t,this.mCompleteHandlerArgs=n,this},n.prototype.setCancelHandler=function(t,n){return void 0===n&&(n=[]),this.mCancelHandler=t,this.mCancelHandlerArgs=n,this},n.prototype.executeSingle=function(c,u){return __awaiter(this,void 0,void 0,function(){var n,e,i,r,o,s,a,l;return __generator(this,function(t){switch(t.label){case 0:return n=this.mSingleCancelHandlers[c],e=this.mSingleCancelHandlerArgs[c],0<u?[4,(i=this.addTimer(c)).forMSeconds(u).wait()]:[3,2];case 1:if((a=t.sent()).isFailed)return n&&n.runWith([].concat(e,a.error)),this.syncLock.cancel(),i.dispose(),i=null,[2];i.dispose(),i=null,t.label=2;case 2:if(c<0||c>=this.mTasks.length)return[2];r=this.mTasks[c],o=this.mSingleHandlers[c],s=this.mSingleCancelHandlerArgs[c],t.label=3;case 3:return t.trys.push([3,5,,6]),[4,r.wait()];case 4:return a=t.sent(),o&&o.runWith([].concat(s,a)),this.syncLock.done(),[3,6];case 5:return l=t.sent(),n&&n.runWith([].concat(e,l)),this.syncLock.cancel(),[3,6];case 6:return[2]}})})},n.prototype.addTimer=function(t){var n=new i.WaitForTime;return this.timers||(this.timers={}),this.timers[t]=n},n.prototype.clearTimer=function(){if(this.timers){for(var t in this.timers)this.timers[t].dispose(),this.timers[t]=null,delete this.timers[t];this.timers=null}},n._sign="_sign_sequent_executor",n);function n(){this.mTasks=[],this.mSingleHandlers=[],this.mSingleHandlerArgs=[],this.mSingleCancelHandlers=[],this.mSingleCancelHandlerArgs=[],this.mCompleteHandler=null,this.mCompleteHandlerArgs=[],this.mCancelHandler=null,this.mCancelHandlerArgs=[],this.mCursor=-1,this.syncLock=null,this.timers=null}i.TaskExecutor=t}(riggerIOC=riggerIOC||{}),function(t){var e,n=(e=t.BaseWaitable,__extends(i,e),i.prototype.adjustTotalNum=function(t){this.totalTaskNum=t,this.check()},i.prototype.done=function(){++this.doneNum,this.check()},i.prototype.cancel=function(){++this.canceledNum,this.check()},i.prototype.check=function(){this.doneNum+this.canceledNum>=this.totalTaskNum&&(0<this.canceledNum?e.prototype.cancel.call(this):e.prototype.done.call(this))},i);function i(t){var n=e.call(this)||this;return n.totalTaskNum=0,n.doneNum=0,n.canceledNum=0,n.totalTaskNum=t,n.doneNum=0,n.canceledNum=0,n}t.TaskExecutorLock=n}(riggerIOC=riggerIOC||{}),function(){function t(t){this.ctr=t,this.inst=null}(riggerIOC||(riggerIOC={})).CommandBindTuple=t}(),function(t){var e,n=(e=t.BaseWaitable,__extends(i,e),i.prototype.dispose=function(){this.mContent=null,e.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"content",{get:function(){return this.mContent},set:function(t){this.setContent(t)},enumerable:!0,configurable:!0}),i.prototype.setContent=function(t){return this.mContent=t,this},i);function i(t){void 0===t&&(t=null);var n=e.call(this)||this;return n.mContent=null,n.setContent(t),n}t.WaitableTask=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.stop=function(){this.listenerManager&&this.listenerManager.stop()},e);function e(t){this.listenerManager=t}t.Event=n}(riggerIOC=riggerIOC||{}),function(s){var t=(n.prototype.dispatch=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var i=this.eventsMap[t];if(i){var r=new s.Event(i);i.execute.apply(i,[r].concat(n))}},n.prototype.on=function(t,n,e){for(var i=[],r=3;r<arguments.length;r++)i[r-3]=arguments[r];var o=this.eventsMap[t];return(o=o||(this.eventsMap[t]=new s.ListenerManager)).on(n,e,i)},n.prototype.off=function(t,n,e){var i=this.eventsMap[t];if(i)return i.off(n,e)},n.prototype.dispose=function(){this.clear(),this.eventsMap=null},n.prototype.clear=function(){for(var t in this.eventsMap)this.eventsMap[t].dispose(),delete this.eventsMap[t]},n);function n(){this.eventsMap={}}s.EventDispatcher=t}(riggerIOC=riggerIOC||{}),function(r){var t=(n.prototype.to=function(t){for(var n=this.bindTuples,e=n.length,i=0;i<e;++i)if(n[i].ctr===t)return this;return n.push(new r.CommandBindTuple(t)),this},n.prototype.toValue=function(t){return this},n.prototype.once=function(){return this},n.prototype.inSequence=function(){return this},n.prototype.toSingleton=function(){throw new Error("command is always Singleton.")},n.prototype.dispose=function(){},n);function n(t){this.message=null,this.message=t,this.bindTuples=[]}r.EventCommandBindInfo=t}(riggerIOC=riggerIOC||{}),function(t){var n,e=(n=t.SafeWaitable,__extends(i,n),i.prototype.cancel=function(t){void 0===t&&(t=null),n.prototype.cancel.call(this,t),this.onCancel(t)},i.prototype.onCancel=function(t){},i);function i(){return null!==n&&n.apply(this,arguments)||this}t.WaitableCommand=e}(riggerIOC=riggerIOC||{}),function(t){var n,e=(n=t.Command,__extends(i,n),i.prototype.execute=function(){this.moduleContext&&this.moduleContext.done()},i.prototype.setModuleContext=function(t){this.moduleContext=t},i.prototype.dispose=function(){this.moduleContext=null},i);function i(){return n.call(this)||this}t.ModuleDoneCommand=e}(riggerIOC=riggerIOC||{}),function(r){var i,o=(i=r.BaseWaitable,__extends(s,i),s.getApplication=function(t){return s.appIdsMap[t]},s.freeAppId=function(t){r.debug&&delete s.appIdsMap[t]},s.mallocAppId=function(){return s.isAppIdValid(s.mNowAppId)?s.mNowAppId:(++s.mNowAppId,s.mallocAppId())},s.isAppIdValid=function(t){return!s.appIdsMap||!s.appIdsMap[t]},Object.defineProperty(s.prototype,"injectionBinder",{get:function(){return this.mInjectionBinder||(this.mInjectionBinder=new r.ApplicationInjectionBinder(this.appId,r.InjectionBinder.instance,this)),this.mInjectionBinder},enumerable:!0,configurable:!0}),s.prototype.launch=function(){return this.wait()},s.prototype.onInit=function(){},s.prototype.dispose=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){if(this.disposing)return[2];for(this.disposing=!0,r.debug||delete s.appIdsMap[this.appId],n=this.modules.length-1;0<=n;--n)this.injectionBinder.unbind(this.modules[n]);return this.modules=null,this.modulesInstance=null,this.commandBinder.dispose(),this.commandBinder=null,this.mediationBinder.dispose(),this.mediationBinder=null,this.mInjectionBinder&&(this.mInjectionBinder.dispose(),this.mInjectionBinder=null),i.prototype.dispose.call(this),[2]})})},s.prototype.getInjectionBinder=function(){return this.injectionBinder},s.prototype.getCommandBinder=function(){return this.commandBinder},s.prototype.getMediationBinder=function(){return this.mediationBinder},s.prototype.startTask=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i.prototype.startTask.apply(this,t),this.bindInjections(),this.bindCommands(),this.modules=[],this.registerModuleContexts(),this.initializeModuleContexts(),this},s.prototype.initializeModuleContexts=function(){return __awaiter(this,void 0,void 0,function(){var n,e,i;return __generator(this,function(t){switch(t.label){case 0:this.modulesInstance=[],e=0,t.label=1;case 1:return e<this.modules.length?(i=this.injectionBinder.bind(this.modules[e]),n=new i.realClass(this),this.modulesInstance.push(n),i.toValue(n),n.start(),[4,n.wait()]):[3,4];case 2:t.sent(),t.label=3;case 3:return++e,[3,1];case 4:return this.done(),[2]}})})},s.prototype.addModuleContext=function(t){return this.modules.push(t),this},s.prototype.bindCommandBinder=function(){this.injectionBinder.bind(r.CommandBinder).toValue(new r.SignalCommandBinder(this.injectionBinder))},s.prototype.bindMediationBinder=function(){this.injectionBinder.bind(r.MediationBinder).toValue(new r.MediationBinder(this.injectionBinder))},s.globalInjectionTracks=[],s.mNowAppId=1,__decorate([r.inject(r.CommandBinder)],s.prototype,"commandBinder",void 0),__decorate([r.inject(r.MediationBinder)],s.prototype,"mediationBinder",void 0),s);function s(t,n){void 0===n&&(n=!0);var e=i.call(this)||this;if(e.disposing=!1,e.mInjectionBinder=null,e.injectionTracks=[],e.disposing=!1,null==t||null==t)t=s.mallocAppId();else if(!s.isAppIdValid(t))throw new Error('"'+t+'" is not a valid app id.');return e.appId=t,s.appIdsMap||(s.appIdsMap={}),s.appIdsMap[t]=e,r.debug&&(e.analyser=new l(e)),e.bindCommandBinder(),e.bindMediationBinder(),e.onInit(),n&&e.launch(),e}r.ApplicationContext=o;var a=function(){this.stickInsts=[],this.instsWithInjectionError=[],this.instsWithDisposeError=[],this.analyseReport=""};r.AnalyseResult=a;var l=(t.prototype.analyze=function(){var t=new a,n=this.stickyInsts;t.stickInsts=n;for(var e="======= 尚未释放的对象 ======\r\n",i=0;i<n.length;++i)e+=n[i].toString()+"\r\n";e+="======= 注入时发生了错误的对象 ======\r\n";var r=this.injectErrorInsts;if(0<(t.instsWithInjectionError=r).length)for(i=0;i<r.length;++i)e+=r[i].toString()+"\r\n";else e+="\r\n";e+="====== 析构时发生错误的对象 =====\r\n",t.instsWithDisposeError=r=this.disposeErrorInsts;for(var o=0;o<r.length;++o)e+=r[o].toString()+"\r\n";return t.analyseReport=e,t},Object.defineProperty(t.prototype,"stickyInsts",{get:function(){for(var t=[],n=this.injectionTracks.concat(o.globalInjectionTracks),e=0;e<n.length;++e){var i=n[e];0<r.getRefCount(i.inst)&&t.push(i)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injectErrorInsts",{get:function(){for(var t=[],n=this.injectionTracks.concat(o.globalInjectionTracks),e=0;e<n.length;++e){var i=n[e];i.injectError&&t.push(i)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disposeErrorInsts",{get:function(){for(var t=[],n=this.injectionTracks.concat(o.globalInjectionTracks),e=0;e<n.length;++e){var i=n[e];i.disposeError&&t.push(i)}return t},enumerable:!0,configurable:!0}),t);function t(t){this.injectionTracks=[],this.appId=t.appId,this.injectionTracks=t.injectionTracks}r.ApplicationContextAnalyser=l}(riggerIOC=riggerIOC||{}),function(e){var i,t=(i=e.BaseWaitable,__extends(n,i),n.prototype.onInit=function(){},n.prototype.dispose=function(){this.doneCommand.dispose(),this.doneCommand=null,this.applicationContext=null,i.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"injectionBinder",{get:function(){return this.applicationContext.getInjectionBinder()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"commandBinder",{get:function(){return this.getCommandBinder()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mediationBinder",{get:function(){return this.getMediationBinder()},enumerable:!0,configurable:!0}),n.prototype.getInjectionBinder=function(){return this.injectionBinder},n.prototype.getCommandBinder=function(){return this.applicationContext.getCommandBinder()},n.prototype.getMediationBinder=function(){return this.applicationContext.getMediationBinder()},n.prototype.start=function(){i.prototype.startTask.call(this),this.onStart()},n=__decorate([e.autoDispose],n));function n(t){var n=i.call(this)||this;return n.applicationContext=t,n.doneCommand=new e.ModuleDoneCommand,n.doneCommand.setModuleContext(n),n.bindInjections(),n.bindCommands(),n.bindMediators(),n.onInit(),n}e.ModuleContext=t}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.dispose=function(){},e=__decorate([t.autoDispose],e));function e(){}t.Model=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.dispose=function(){},e=__decorate([t.autoDispose],e));function e(){}t.Server=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.dispose=function(){this.listenerMgr&&this.listenerMgr.dispose(),this.listenerMgr=null},e.prototype.dispatch=function(t){this.listenerMgr&&this.listenerMgr.execute(t)},e.prototype.on=function(t,n,e,i){void 0===i&&(i=!0),this.makeSureListenerManager(),this.listenerMgr.on(t,n,e,!1,i)},e.prototype.once=function(t,n,e,i){void 0===i&&(i=!0),this.makeSureListenerManager(),this.listenerMgr.on(t,n,e,!0)},e.prototype.off=function(t,n){this.listenerMgr&&this.listenerMgr.off(t,n)},e.prototype.makeSureListenerManager=function(){this.listenerMgr||(this.listenerMgr=new t.ListenerManager)},e=__decorate([t.autoDispose],e));function e(){}t.Signal=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.wrap=function(t){if(!t)return null;if(t.hasOwnProperty(e.ID_KEY))return t[e.ID_KEY];var n=e.mallocId();return t[e.ID_KEY]=n},e.unWrap=function(t){delete t[e.ID_KEY]},e.getId=function(t){return t.hasOwnProperty(e.ID_KEY)?t[e.ID_KEY]:null},e.mallocId=function(){return e.NOW_ID++},e.NOW_ID=1,e.ID_KEY="$iocid",e);function e(){}t.InjectionWrapper=n}(riggerIOC=riggerIOC||{}),function(t){var n=(Object.defineProperty(e.prototype,"reason",{get:function(){return this.error},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOk",{get:function(){return null==this.error||null==this.error},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFailed",{get:function(){return!this.isOk},enumerable:!0,configurable:!0}),e);function e(t,n){void 0===t&&(t=null),void 0===n&&(n=null),this.result=t,this.error=n}t.Result=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.isString=function(t){return"string"==typeof t},e.isArray=function(t){return t instanceof Array},e.isNullOrUndefined=function(t){return null==t},e.isNullOrEmpty=function(t){return e.isNullOrUndefined(t)||t.length<=0},e.isNumber=function(t){return!e.isNullOrUndefined(t)&&!e.isString(t)&&!isNaN(t)},e);function e(){}t.Utils=n}(riggerIOC=riggerIOC||{}),function(t){var n=(e.prototype.getPoolBySign=function(t){var n=this.objectPool[t];return n||(this.objectPool[t]=n=[]),n},e.prototype.clearBySign=function(t){delete this.objectPool[t]},e.prototype.recover=function(t,n){this.getPoolBySign(t).push(n)},e.prototype.getItemByClass=function(t,n){var e=this.getItem(t);return e||new n},e.prototype.getItemByCreateFun=function(t,n){var e=this.getItem(t);return e||n()},e.prototype.getItem=function(t){var n=this.getPoolBySign(t);return n.length<=0?null:n.pop()},e.prototype.forEach=function(t){if(t){var n=this.objectPool;if(n)for(var e in n)for(var i=n[e],r=0;r<i.length;++r)t(i[r])}},e.prototype.dispose=function(){this.objectPool=null},e);function e(){this.objectPool={},this.objectPool={}}t.Pool=n}(riggerIOC=riggerIOC||{}),function(t){var n=(Object.defineProperty(o,"pool",{get:function(){return o.m_pool||(o.m_pool=new t.Pool),o.m_pool},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"caller",{get:function(){return this._caller},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ifOnce",{get:function(){return this._ifOnce},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"args",{get:function(){return this._args},enumerable:!0,configurable:!0}),o.prototype.dispose=function(){this._caller=null,this._method=null,this._args=null,this._ifOnce=!1},o.create=function(t,n,e,i){void 0===e&&(e=null),void 0===i&&(i=!1);var r=o.pool.getItem(o.riggerHandlerSign);return r?(r._caller=t,r._method=n,r._args=e,r._ifOnce=i,r):new o(t,n,e,i)},o.recover=function(t){t.dispose(),o.pool.recover(o.riggerHandlerSign,t)},o.prototype.replace=function(t,n,e,i){void 0===i&&(i=!1),this._caller=t,this._method=n,this._args=e,this._ifOnce=i},o.prototype.recover=function(){o.recover(this)},o.prototype.once=function(){this._ifOnce=!0},o.prototype.canReplace=function(t,n){return t==this.caller&&this.method==n},o.prototype.run=function(){if(this._method){var t=this._method.apply(this._caller,this._args);return this._ifOnce&&this.recover(),t}},o.prototype.runWith=function(t){if(!t)return this.run();if(this._method){var n=void 0;return n=this._args?this._method.apply(this._caller,this._args.concat(t)):this._method.apply(this._caller,t),this._ifOnce&&this.recover(),n}return null},o.riggerHandlerSign="_riggerHandlerSign",o);function o(t,n,e,i){void 0===e&&(e=null),void 0===i&&(i=!1),this._ifOnce=!1,this._caller=t,this._method=n,this._args=e,this._ifOnce=i}t.Handler=n}(riggerIOC=riggerIOC||{}),function(s){var t=(n.prototype.dispose=function(){this.stopped=!1,this.clear()},n.prototype.on=function(n,e,t,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!0),this.handlers||(this.handlers=[]),r)return(o=this.handlers.find(function(t){return t.canReplace(n,e)}))?o.replace(n,e,t,i):(o=s.Handler.create(n,e,t,i),this.handlers.push(o)),o;var o=s.Handler.create(n,e,t,i);return this.handlers.push(o),o},n.prototype.off=function(t,n){if(this.handlers&&!(this.handlers.length<=0)){for(var e=[],i=0;i<this.handlers.length;i++){var r=this.handlers[i];if(r.caller===t&&r.method===n){r.recover();break}e.push(r)}for(++i;i<this.handlers.length;++i)e.push(this.handlers[i]);this.handlers=e}},n.prototype.offAll=function(t,n){if(this.handlers&&!(this.handlers.length<=0)){for(var e=[],i=this.handlers,r=i.length,o=0;o<r;++o)t!==i[o].caller||n!==i[o].method?e.push(i[o]):i[o].recover();this.handlers=e}},n.prototype.clear=function(){if(this.handlers&&!(this.handlers.length<=0)){for(var t=0;t<this.handlers.length;t++)this.handlers[t].recover();this.handlers=null}},n.prototype.stop=function(){this.stopped=!0},n.prototype.execute=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this.handlers&&!(this.handlers.length<=0)){for(var e,i=this.handlers,r=i.length,o=[],s=0;s<r&&!this.stopped;++s)(e=i[s]).runWith(t),e.method&&o.push(e);for(;s<r;++s)o.push(i[s]);this.stopped=!1,this.handlers=o,o=i=e=null}},n);function n(){this.stopped=!1}s.ListenerManager=t}(riggerIOC=riggerIOC||{});